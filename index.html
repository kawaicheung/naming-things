<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Fredericka+the+Great|Lora:400,400i,700,700i|Roboto+Mono&display=swap" rel="stylesheet">
  <link href="styles.css" rel="stylesheet" type="text/css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>
<body>
<div class="menu">
  <a href="">
    <svg height="32px" id="Layer_1" style="enable-background:new 0 0 32 32;" version="1.1" viewBox="0 0 32 32" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>
  </a>
</div>
<div class="toc" id="toc">
  <a href="" class="close-btn">&times;</a>
  <div class="toc-content">
    <h3>Naming Things</h3>
    <a href="#ch-introduction">Introduction</a>
    <a href="#ch-imagining-objects">Imagining Objects</a>
    <a href="#ch-name-hunting">Name Hunting</a>
    <a href="#ch-breaking-methods-apart">Breaking Methods Apart</a>
    <a href="#ch-shape-of-code">The Shape of Code</a>
    <a href="#ch-when-opposites-confuse">When Opposites Confuse</a>
    <a href="#ch-tautologous-name-trap">The Tautologous Name Trap</a>
    <a href="#ch-names-are-fickle">Names are Fickle</a>
    <a href="#ch-abstracting-too-soon">Abstracting Too Soon</a>
    <a href="#ch-speaking-the-native-tongue">Speaking the Native Tongue</a>
    <a href="#ch-naming-and-teaching">Naming and Teaching</a>
    <a href="#ch-authors-note" class="extended">Author&rsquo;s Note</a>
  </div>
</div>

<div class="bookmark">
</div>
<div class="grid-cover">
  <div class="cover">
    <h1>Naming Things</h1>
    <h2>Thoughts on one of coding&rsquo;s most elusive tasks.<br />By Ka Wai Cheung of <a href="https://www.donedone.com" target="_blank">DoneDone</a>.</h2>
    <h4><a href="#" id="btn-cover-click">Start reading...</a></h4>
  </div>  
</div>

<div class="chapter" id="ch-introduction">
  <div class="grid-content">
    <div class="content">
      <h2>Introduction</h2>
      <p class="emphasis">
        Here&rsquo;s a little insight into what I think about when I write code.
      </p>
      <p>
        I&rsquo;m working on&mdash;what I&rsquo;ll call for now&mdash;a <em>data migration</em> feature. It&rsquo;s for the brand new version of <a href="https://www.donedone.com">DoneDone</a>, the task tracking and customer support app I&rsquo;ve worked on for the past decade. Developing a product for this long, I&rsquo;m intimately familiar with its code&mdash;like a scupltor chiseling away endlessly at a large piece of stone.
      </p>
      <p>
        The goal of this migration feature is to give our customers an easy way to bring their existing data over from the old version of DoneDone (which we call <em>Classic</em>) to this new version. I wish I could tell you this is a simple mapping of database tables from Classic over to the new version, but it&rsquo;s far from it. The new DoneDone is markedly different from its predecessor; Some data maps simply, other data requires some massaging, and some stuff simply can&rsquo;t be mapped at all.
      </p>
      <p>
        For the next week, I chisel away at this feature from top to bottom. I develop a screen to sign in to the old system, one to let users choose the projects they want to move over, and one to see the progress of their migration requests. On the backend, I work on a number of database updates to store these requests. I then write a separate service that picks up these requests to perform the arduous work of moving this data over &ldquo;cleanly&rdquo;. There are other tangential pieces I build along the way, like emailing the requester when the migration is complete and broadcasting error notifications.
      </p>
      <p>
        It&rsquo;s intense work. But after a week, I feel confident about this new feature.
      </p>
      <p>
        Before I&rsquo;m ready to release it, I give my code another onceover&mdash;like re-reading a manuscript from the beginning again with a fresh set of eyes. I tend to pick out things I don&rsquo;t like about my code best this way.
      </p>
      <p>
        The first thing I look at is naming. I try to use the same terms when I write code as when I <em>talk</em> about a feature. This avoids any unnecessary mental mapping when I transition between the screen and the rest of the world. So naturally, my codebase is littered with derivates of the word <em>migration</em>.
      </p>
      <ul>
        <li>There&rsquo;s a <code>ClassicMigrator</code> project in my codebase.</li>
        <li>Methods named <code>QueueMigrationRequest()</code> and <code>MigrateClassicProjects()</code>.</li>
        <li>Class properties like <code>EligibleForMigration</code> and <code>HasMigratableProjects</code>.</li>
        <li>There are models, views, and controllers with every derivative of <em>Migrate</em> sprinkled around. The copy on the application uses the words <em>migrate</em> and <em>migration</em> too.
      </li>
      </ul>
      <p>
        On this re-read, the word is eating at me. Mike (my business partner) and I have been using the word &ldquo;migration&rdquo; in reference to this feature the whole time. It&rsquo;s an important word to get right. 
      </p>
      <p>
        Sometimes you use a word so much that you no longer think about what it actually means; You just know what it&rsquo;s <em>supposed</em> to mean. Here&rsquo;s the problem: We aren&rsquo;t actually migrating data. 
      </p>
      <p>
        Migrate has this connotation that something is leaving one place to go to another, like a flock of birds migrating south for the winter. In our case, data isn&rsquo;t leaving the Classic version. That data is still there&mdash;untouched&mdash;after the migration. I wrote it this way so existing customers can try the new system using their existing data, but if they don&rsquo;t like it, they can stick with Classic.
      </p>
      <p>
        Migrate is misleading. Using that word in the application copy might make customers apprehensive about their existing data. Using that word in code might confuse future developers about what the feature actually does.
      </p>
      <p>
        I contemplate replacing <em>migration</em> with <em>copy</em>. It&rsquo;s clear that copying doesn&rsquo;t mean removing the original. But, this isn&rsquo;t quite right either. As I mentioned earlier, this data transfer isn&rsquo;t a literal copy. There are some things that don&rsquo;t translate perfectly, or at all. Copying also seems like a fast, mindless operation&mdash;a simple <span class="key">CTRL</span>+<span class="key">C</span> <span class="key">CTRL</span>+<span class="key">V</span> exercise. That&rsquo;s not what this is.
      </p>
      <p>
        I tell Mike about my conundrum. 
      </p>
      <p>
        After some thought, he suggests we use the word <em>import</em> instead. Ah ha!
      </p>
      <p>
        There&rsquo;s a heftiness to the word <em>import</em> that feels right. Whenever I think about importing data, I envision metallic gear icons and the momentary spiking of CPU graphs. Even when you import things in the real world, it has that same feeling of heft&mdash;huge cargo ships meandering across the ocean lugging thousands of tons of goods.
      </p>
      <p>
        The word <em>import</em>, as it&rsquo;s normally used in technical terms, also doesn&rsquo;t feel like data is leaving one place and going to another. I think of importing data from a file I&rsquo;ve uploaded. I know the data on the file doesn&rsquo;t disappear. I also don&rsquo;t necessarily expect a one-to-one mapping between my data and the imported data. Import seems like the perfect word to me.
      </p>
      <p>
        So, I end up substituting <em>migrate</em>, and all its various derivatives, with <em>import</em>. I&rsquo;m much happier with this change.
      </p>
      <hr />
      <p>
        I obsess over names. Finding that perfect name gives me the same kind of adrenaline boost I get after I&rsquo;ve solved a difficult problem or figured out a much cleaner approach to an ugly solution. 
      </p>
      <p>
        My obsession with naming started from a quote I read some time ago. If you&rsquo;ve written code long enough, there&rsquo;s a good chance you&rsquo;ve heard it as well.
      </p>
      <blockquote>
        &ldquo;There are only two hard things in Computer Science: cache invalidation and naming things.&rdquo;
      </blockquote>
      <div class="quoter">
        Phil Karlton
      </div>
      <p>
        Karlton was a software architect at Netscape. There is suprisingly little other information I could find about him though I&rsquo;m sure he&rsquo;s done great work. But, it&rsquo;s this quote that he will be forever remembered by in the programming industry.
      </p>
      <p>
        The first time I read this quote, I remember chuckling to myself. First, because I can think of many things that are difficult for me in programming. Second, because naming wasn&rsquo;t initially among those things; I had never thought about naming as a difficult exercise. Yet, we all have written and read names that confuse, misdirect, conflate, or otherwise mistify us. 
      </p>
      <p>
        So, how do you name things well? Unlike so many other things in programming, an incoherent name won&rsquo;t be caught by the compiler. There are no metrics for naming. A bad name won&rsquo;t break your code. A good name won&rsquo;t speed up your build.
      </p>
      <p>
        Naming is elusive. It has a lot to do with gut, feel, style and even aesthetics. It is, in my humble opinion, the most subjective of technical subjects.
      </p>
      <p>
        Though there are no metrics for good names, it deserves as much attention as all the other skills we preach in programming&mdash;like good architecture, writing &ldquo;clean code&rdquo;, or rigid testing. While these other practices are critical, they share the common drawback that you cannot see these things instantly. It&rsquo;s only after digesting the codebase and working with it for awhile that you reap its benefits. 
      </p>
      <p>
        On the other hand, a codebase with good names pays off <em>immediately</em>. They are the first things a programmer sees when reading new code. They make code more approachable. With modern tooling, you can also change the names of things safely and quickly.
      </p>
      <hr />
      <p>
        This book is about how focusing on names can drive us toward better code&mdash;regardless of the languages, tools, or development environment you use. Many of the examples in this book come directly from, or were inspired by, real code I&rsquo;ve written for DoneDone over the past decade. <a href="#ch-imagining-objects">Let&rsquo;s begin</a>.
      </p>
    </div>
  </div>
</div>
<div class="chapter" id="ch-imagining-objects">
  <div class="grid-content">
    <div class="content">
      <h2>Imagining Objects</h2>
      <p class="emphasis">
        I think the term <em>object-oriented programming</em> is misleading.
      </p>
      <p>
        Textbooks tend to explain concepts like classes and interfaces by using dogs, cats, and other domesticated cuddly animals. But, these aren&rsquo;t realistic examples for most coders. Most of the things we call &ldquo;objects&rdquo; in code don&rsquo;t have a direct physical representation in the real world. 
      </p>
      <p>
        We should really call it noun-oriented programming. A noun can be a person, place, thing, or idea. Most classes really are <em>ideas with functionality</em>. 
      </p>
      <p>
        Classes sometimes manifest because we find ourselves with a set of functions and properties that have a common purpose that we want to wrap up in a neat little bundle. But, these classes don&rsquo;t always have a physical translation. This is where wishy-washy names like <code>UserManager</code>, <code>MessagingHelper</code>, and <code>AppHandler</code> are born. 
      </p>
      <p>
        Working through a codebase littered with these kinds of class names reminds me of working in a bloated organization where everybody is some form of middle-management. When should I direct a question to the <em>Regional Vice President</em> versus the <em>District Assistant Principal</em>?
      </p>
      <p>
        When I read code like this, I have to dig into these classes to figure out what purpose they serve. When I know there&rsquo;s some functionality out there I want to leverage, I have a harder time remembering where it lives. <em>Was it in that helper doohickey or in the other manager thingamajig?</em>
      </p>
      <p>
        There are ways around this. Generic names might be a sign that the guts of the class belong elsewhere. For instance, maybe the methods inside that <code>UserManager</code> class can be moved into the <code>User</code> class itself. It might also be a sign that the class does too many things and needs to be split up into smaller pieces. Perhaps there are natural groupings inside that <code>AppHandler</code> class&mdash;one that handles initialization, one that handles routing, one that deals with exception handling, and so forth. More specific names can be derived from there.
      </p>
      <p>
        If it&rsquo;s neither of those cases, sometimes I just have to face reality: A class can be hard to name because it does something that doesn&rsquo;t easily translate in the real world. That&rsquo;s when a little imagination helps. Even when a class is responsible for something that only makes sense in my code, there&rsquo;s usually some metaphorical noun out there I can apply to it to make it memorable. This makes it easier to recall when I need to revisit that &ldquo;object&rdquo; again.
      </p>
      <hr />
      <p>
        The other day, I was looking at code I wrote awhile back that allows DoneDone users to reset their password. The reset password function works like most other apps:
      </p>
      <ul>
        <li>A user enters their email address in a &ldquo;Forgot Password&rdquo; form from the app.</li>
        <li>They receive an email with a link containing an encrypted token embedded in the querystring.</li>
        <li>When clicked, the request passes the token to the server and is decrypted.</li>
        <li>The information from the decryption determines whether the reset link is still valid and which user originally requested the reset.</li>
      </ul>
      <p>
        On this re-read, I don&rsquo;t like how the token concept is implemented. Bits of logic are sprinkled in too many places. The token is encrypted on one layer of the stack and decrypted on a completely different layer. There are also a couple of places where I write repeated code to check whether the token is still valid. 
      </p> 
      <p>
        But, what makes me most hungry to clean this code up is that the concept is <em>nearly identical</em> to the process a user takes to complete their initial registration.
      </p>
      <p>
        It&rsquo;s clear that a better approach is to wrap up this token into a single object. Let the object handle all of it&mdash;the encryption, decryption, and validation of the token. Then, I can re-use it for both password resets and user registrations.
      </p>
      <p>
        I get to a place I&rsquo;m quite happy with. The guts of the object look something like this. 
      </p>
    </div>
  </div>
  <div class="grid-left-code">
    <div class="code-block">
      <pre>
public sealed class <span class="blanked">AuthToken</span>
{
  private readonly DateTime _utc_date_issued;

  public readonly int UserID;
  public readonly string EmailAddress;
  public readonly string EncryptedToken;

  <span class="1-d1">public AuthToken(int user_id, string email)
  {
    UserID = user_id;
    EmailAddress = email.ToLower().Trim();
    _utc_date_issued = DateTime.UtcNow;
    EncryptedToken = // Omitted for simplicity...
  }</span>

  <span class="1-d2">public AuthToken(string encrypted_token)
  {
    try
    {
       EncryptedToken = encrypted_token;
       UserID = // Deduced from the token...
       EmailAddress = // Deduced from the token...
       _utc_date_issued = // Deduced from the token...
    }
    catch
    {
      throw new InvalidInput("Cannot decrypt token!");
    }
  }</span>

  <span class="1-d3">public bool IssuedWithinMinutes(int minutes)
  {
    return (_utc_date_issued.AddMinutes(minutes) > DateTime.UtcNow);
  }</span>
}</pre>
    </div>
    <div class="content">
      <p>
        Taking a quick walkthrough of this object, you&rsquo;ll notice that there are two constructors. 
      </p>
      <p>
        <a href="#" class="code-ref" data-code-ref="1-d1">One hydrates the properties of the object with a <code>user_id</code> and <code>email</code> of the user when a password reset (or registration completion request) is initiated</a>. The timestamp of the token is set to the moment the instance is created. It also wraps all of this data together into an encrypted token. 
      </p>
      <p>
        <a href="#" class="code-ref" data-code-ref="1-d2">The other hydrates the same object with the encrypted token. The token is decrypted and the other properties are deduced from the decryption</a>. This is called during the request when a user clicks the link they received from the email.
      </p>
      <p>
        <a href="#" class="code-ref" data-code-ref="1-d3">The <code>IssuedWithinMinutes</code> public method allows code elsewhere to decide whether to honor the request</a>. For instance, a password reset link might be valid for only ten minutes whereas a user registration link could be valid for a few hours.
      </p>
    </div>

  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        I&rsquo;m giddy with the promises of such an object. I&rsquo;m able to clean up some duplicate logic used by both the password reset and user registration processes. Whereas the encryption and decryption process once lived in random helper methods on different layers of the stack, they now have a comfortable home.
      </p>
      <p>
        The last hurdle, however, is a big one. What do I name this thing? This &ldquo;object&rdquo; is not a dog or cat. I don&rsquo;t really know what this thing is. 
      </p>
      <p>
        My initial attempt, <code>AuthToken</code> was half-hearted. I just wanted to get something down so I could finish the implementation. Reading this name again brings up all sorts of questions and lackluster answers.
      </p>
      <ul>
        <li>
          <strong>Does &ldquo;Auth&rdquo; mean &ldquo;Authorization&rdquo; or &ldquo;Authentication&rdquo;?</strong> In this case, it kind of means <em>both</em>. That doesn&rsquo;t really help.
        </li>
        <li>
          <strong>Does this object represent the encrypted token?</strong> Kind of. It really represents the encrypted token <em>in addition to</em> the data the token represents. Calling it <code>AuthToken</code> while also having a property with the name <code>EncryptedToken</code> is confusing. It&rsquo;s more than just the token. It&rsquo;s easy to get into the trap of naming an object for only part of its reason for being.
        </li>
        <li>
          <strong>What is this object supposed to be used for?</strong> In the lexicon of object naming, <code>AuthToken</code> is about as generic as <code>UserManager</code>.
        </li>
      </ul>
      <p>
        This clearly isn&rsquo;t the right name. But, what comparable thing possibly exists in the real world like this? 
      </p>
      <p>
        I begin to think about something that an <em>authority</em> creates for someone, who can later exchange this thing to do whatever the authority said they could do. 
      </p>
      <p>
        A <em>ticket</em> comes to mind. But, that conjures up thoughts of going to a sporting event or movie premiere, as if there&rsquo;s a specific time and place to redeem it. It also makes me think of a parking ticket. Password resets and user registrations are neither particularly exciting nor dreadful. The metaphor doesn&rsquo;t feel quite right.
      </p>
      <p>
        A <em>permit</em>? A permit is valid for a set period of time and it lets someone do something agreed to by an authority until it expires. Plus, a permit is something given to you usually by a governing body, not your local movie theater or sporting venue. This feels spot on.
      </p>
      <p>
        <a href="#" class="code-ref" data-code-ref="1-d4">I end up changing the class name to <code>PermitForUserUpdate</code></a>. The implementation instantly feels more readable. For instance, <a href="#" class="code-ref" data-code-ref="1-d5">the method <code>IssuedWithinMinutes()</code> reads more naturally</a> when used in context. Permits in the real world are normally <em>issued</em>. Here&rsquo;s how I can validate a password reset permit hasn&rsquo;t expired yet.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
var permit = new <span class="1-d4">PermitForUserUpdate</span>(encrypted_token);

if (!<span class="1-d5">permit.IssuedWithinMinutes(10)</span>)
{
  throw new Exception("This permit is expired!");
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <hr />
      <p>
        When opportunities like these present themselves in your code, stop for a minute and see if you can find a replacement for that really vague class name. Renaming classes might require a little bit of imagination, but done repeatedely, your objects become more memorable and your codebase starts to read more fluidly.
      </p>
    </div>
  </div>
</div>

<div class="chapter" id="ch-name-hunting">
  <div class="grid-content">
    <div class="content">
      <h2>Name Hunting</h2>
      <p class="emphasis">
        There never seems to be time to clean up code. 
      </p>
      <p>
        No client wants to pay for it. No product manager wants to see energy spent with no feature improvements. You sometimes have to clean up surreptitiously as you go. Do it behind their backs.
      </p>
      <blockquote class="smaller">
        &ldquo;Of course, many [managers] say they are driven by quality but are more driven by schedule...In these cases I give my more controversial advice: Don&rsquo;t tell! Subversive? I don&rsquo;t think so.&rdquo;
      </blockquote>
      <div class="quoter">
        Martin Fowler, <a href="https://martinfowler.com/books/refactoring.html">Refactoring: Improving the Design of Existing Code</a>
      </div>
      <p>
        The good news is, you don&rsquo;t need a long stretch of dedicated time to make positive impacts on your code. You can get a lot done in small spurts. One of my favorite exercises is one of the simplest: <em>Find things to name</em>. I look for bits of overexposed logic, then replace the logic with a method or property that I can define with a meaningful name. Done repeatedly, it can quickly make souring code sweet. 
      </p>
      <hr />
      <p>
        On the new DoneDone, we&rsquo;re using <a href="https://vuejs.org/">Vue.js</a> to deliver most of our front-end. I notice a conditional on a Vue element that looks like this:
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
&lt;div <span class="2-d1">v-if="![&rsquo;xs&rsquo;, &rsquo;sm&rsquo;, &rsquo;md&rsquo;].includes($mq)"</span>&gt;
    ...
&lt;/div&gt;</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        If you&rsquo;re unfamiliar with Vue syntax, no big deal. The <a href="#" class="code-ref" data-code-ref="2-d1"><code>v-if</code> attribute</a> works just like a normal <code>if</code> statement, with a Typescript expression inside of it. Inside an HTML element, it determines if that element should be rendered at all. In this case, I have a <code>&lt;div&gt;</code> that I only want to show if the statement <code>![&rsquo;xs&rsquo;, &rsquo;sm&rsquo;, &rsquo;md&rsquo;].includes($mq)</code> is true.
      </p>
      <p>
        But, what does this code <em>actually</em> mean? Well, it evaluates to <code>true</code> if the &ldquo;extra small&rdquo;, &ldquo;small&rdquo;, or &ldquo;medium&rdquo; media query breakpoints are <em>not</em> hit based on the size of the browser. Put more meaningfully, it tells us if <em>the current browser width is sized to at least the width of a normal desktop screen</em>.
      </p>
      <p>
        When I scan this statement, it looks cryptic. Out of place. Too specific in the context of the code around it. 
      </p>
      <p>
        I can quickly fix this line by swapping the logic with a well-named property, like <a href="#" class="code-ref" data-code-ref="2-d2"><code>isDesktopWidth</code></a>.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
<span class="2-d2">isDesktopWidth()</span>: boolean {
  return ![&rsquo;xs&rsquo;, &rsquo;sm&rsquo;, &rsquo;md&rsquo;].includes(this.$mq)
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        Now, I get the satisfaction of cleaning up my original code up with something much more approachable.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
&lt;div v-if="isDesktopWidth"&gt;
    ...
&lt;/div&gt;</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        Not only does this read better, but I have a property I can reuse again in other parts of the application.
      </p>
      <hr />
      <p>
        You can spot an opportunity like this from a mile away&mdash;an overly technical bit of code lying around without a proper home. I usually write code like this on the first pass, when I&rsquo;m just trying to get a feature to work right and I don&rsquo;t care about where all the pieces fit. But, if I never make that second pass, then things quickly turn ugly.
      </p>
      <p>
        In my earlier days, it would be easy to forget to do that second pass because I got lost in the relief of simply getting code to work right&mdash;or I was already past the deadline I had set for myself to do so.
      </p>
      <p>
        I don&rsquo;t skip that second pass anymore. It&rsquo;s this pass where I focus heavily on naming. Where I look to say <em>what</em> rather than <em>how</em>. Where the readability of my code improves dramatically. It&rsquo;s as critical a step as the first. 
      </p>
      <p>
        Take a moment to look at your own code&mdash;regardless of where you are in your stack. You might be surprised how many bits of messy logic are sprinkled about that you could wrap up into a meaningful name.
      </p>
      <h3>Empowering your objects</h3>
      <p>
        Logic bits don&rsquo;t always have to look overly <em>technical</em> to benefit from replacing it with a named method or property. 
      </p>
      <p>
         Even in a case where I might see business logic already using the well-named properties of an object, there&rsquo;s usually a way I can name that piece of logic and push it <em>back</em> into the class definition. Here&rsquo;s an example. 
      </p>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        I have a <code>Person</code> class that houses some basic information used throughout my codebase.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
public class Person
{
    public string FirstName;
    public string LastName;
    public DateTime LastAccessTimestamp;
    public AccountRole Role;
    ...
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        Instances of <code>Person</code> naturally spring up all over the place.
      </p>
    </div>
  </div>
  <div class="grid-left-code">
    <div class="content">
      <p>
        For example, on a person&rsquo;s profile screen, <a href="#" class="code-ref" data-code-ref="2-d3">I have an instance of <code>Person</code> named <code>authedPerson</code></a> used to display an user&rsquo;s full name and a few links to other sections of the application, but only if they are an admin or owner in the account.
      </p>
    </div>
    <div class="code-block">
      <pre>
&lt;div&gt;
  &lt;h2&gt;<span class="2-d3">@authedPerson.FirstName @authedPerson.LastName</span>&lt;/h2&gt;
  @if (<span class="2-d3">authedPerson.Role == AccountRole.ADMIN || 
       authedPerson.Role == AccountRole.OWNER</span>)
  {
      &lt;a href="..."&gt;Edit&lt;/a&gt; | &lt;a href="..."&gt;Cancel&lt;/a&gt;
  }
&lt;/div&gt;</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        In another part of the application, <a href="#" class="code-ref" data-code-ref="2-d4">I use a person&rsquo;s first name and last initial</a> to prep notification messages when they update a task.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
var subject = <span class="2-d4">person.FirstName + " " +  person.LastName.Substring(0,1) + ".</span> updated the task.";</pre>
    </div>
  </div>
  <div class="grid-right-code">
    <div class="content">
      <p>
        I also have a method inside of a security class that checks <a href="#" class="code-ref" data-code-ref="2-d5">if a person has accessed the application within an hour</a>. If not, I require them to log in again.
      </p>
    </div>
    <div class="code-block">
      <pre>
if ((<span class="2-d5">person.LastAccessTimestamp - DateTime.UtcNow).TotalMinutes > 60</span>)
{
    // Log out and send to the login screen.
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        There are a handful of other occurences like the examples above, where little bits of business logic against a <code>Person</code>&rsquo;s properties are sprinkled about. Most of these bits feel so inconsequentually minor&mdash;simple, one-line constructions and statements&mdash;you might not even consider them to be &ldquo;business logic&rdquo; at all.
      </p>
    </div>
  </div>
  <div class="grid-right-code">
    <div class="content">
      <p>
        For instance, in the profile screen example, displaying a person&rsquo;s first and last name might not seem like <em>logic</em>, but it is&mdash;it represents a person&rsquo;s <a href="#" class="code-ref" data-code-ref="2-d6">full name</a>. I can push this bit of logic back to the <code>Person</code> class itself and name it something meaningful. 
      </p>
    </div>
    <div class="code-block">
      <pre>
public string <span class="2-d6">FullName</span>
{
  get
  {
    return FirstName + " " + LastName;
  }
}</pre>
    </div>
  </div>
  <div class="grid-left-code">
    <div class="content">
      <p>
        The same can be done for the special format of the person&rsquo;s name in the subject line of the notification message. I could call this an <a href="#" class="code-ref" data-code-ref="2-d7">abbreviated name</a>.
      </p>
    </div>
    <div class="code-block">
      <pre>
public string <span class="2-d7">AbbreviatedName</span>
{
  get
  {
    return FirstName + " " + LastName.Substring(0,1) + ".";
  }
}</pre>
    </div>
  </div>
  <div class="grid-right-code">
    <div class="content">
      <p>
        Back on the profile screen, I can move the check for whether a person is an admin or owner as a property of the <code>Person</code> instead. In this case, the check determines whether this person has administrative access. <a href="#" class="code-ref" data-code-ref="2-d8"><code>HasAdminAccess</code> is a sound name</a> for this new property.
      </p>
    </div>
    <div class="code-block">
      <pre>
public bool <span class="2-d8">HasAdminAccess</span>
{
  get
  {
    return Role == AccountRoleType.ADMIN || Role == AccountRoleType.OWNER;
  }
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        The application access logic against the <code>Person</code> object within the security class can be pushed back to the class in a couple of ways. Here&rsquo;s that conditional statement again.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
if ((person.LastAccessTimestamp - DateTime.Now).TotalMinutes > 60)...
</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        There are a few ways I could go about moving this. The entire statement is asking if the person has been idle for more than 60 minutes, so I could take this entire statement and turn it into <a href="#" class="code-ref" data-code-ref="2-d9">a boolean property off <code>Person</code> like so</a>:
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
public bool <span class="2-d9">HasPersonBeenIdleForMoreThan60Minutes</span>
{
  get
  {
    return (person.LastLoggedIn - DateTime.Now).TotalMinutes > 60;
  }
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        This cleans up <em>all</em> of the logic from the security method. But, the name feels way too specific. If someone were just inspecting the <code>Person</code> class, they might ask why such a specific property exists. In addition, if I change the requirements around the idle time, I might easily forget to change the name of the property. 
      </p>
      <p>
        I don&rsquo;t like these tradeoffs. In this case, I&rsquo;d rather pull back on the specificity of the property so it has a better chance of being reused and maintained well over time.
      </p>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        For instance, I could push <em>just</em> the calculation of the idle minutes into the object and call this property <code>MinutesIdle</code>.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
public int MinutesIdle
{
  get
  {
    return (person.LastAccessTimestamp - DateTime.Now).TotalMinutes;
  }
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        Or, I could convert the logic to a method and let the caller <a href="#" class="code-ref" data-code-ref="2-d9-1">pass in the idle minutes</a> to compare.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
public bool IdleLongerThanMinutes(<span class="2-d9-1">int minutes</span>)
{
  return (person.LastAccessTimestamp - DateTime.Now).TotalMinutes > minutes;
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        These two examples are both decent options. But, I like the first option&mdash;it feels more straightforward and reads more coherently.
      </p>
      <p>
        With these updates, the <code>Person</code> class now develops into something a lot more powerful. Here&rsquo;s what the full class now looks like with these additional, well-named properties.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
<pre>
public class Person
{
    public string FirstName;
    public string LastName;
    public DateTime LastLoggedIn;
    public AccountRoleType Role;
    
    public string FullName
    {
      get
      {
        return FirstName + " " + LastName;
      }
    }  
    
    public string AbbreviatedName
    {
      get
      {
        return FirstName + " " + LastName.Substring(0,1) + ".";
      }
    } 
    
    public bool HasAdminAccess
    {
      get
      {
        return Role == AccountRoleType.ADMIN || 
               Role == AccountRoleType.OWNER;
      }
    } 
    
    public int MinutesIdle
    {
      get
      {
        return (person.LastAccessTimestamp - DateTime.Now).TotalMinutes;
      }
    } 
    ...
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
       <p>
        By moving this logic into the <code>Person</code> class, it&rsquo;s now easier to DRY up my codebase. There will likely be other places that require displaying a person&rsquo;s full name or knowing whether they have administrative privileges. Those answers are already baked into the object itself.
      </p>
    </div>
  </div>
  <div class="grid-right-code">
    <div class="content">
      <p>
        Besides reuse, the biggest gain comes from the improved readability of my code. Here&rsquo;s how the improved implementations look like. In my HTML markup, the business logic visually competes far less with the HTML around it.
      </p>
    </div>
    <div class="code-block">
<pre>
&lt;div&gt;
  &lt;h2&gt;@authedPerson.FullName&lt;/h2&gt;
  @if (authedPerson.HasAdminAccess)
  {
      &lt;a href="..."&gt;Edit&lt;/a&gt; | &lt;a href="..."&gt;Cancel&lt;/a&gt;
  }
&lt;/div&gt;</pre>
    </div>
  </div>
  <div class="grid-right-code">
    <div class="content">
      <p>
        The subject of the email notification can also be interpreted with one glance. You don&rsquo;t spend time focusing on the details of how the person&rsquo;s name is being displayed anymore.
      </p>
    </div>
    <div class="code-block">
<pre>
var subject = person.AbbreviatedName + " updated the task.";</pre>
    </div>
  </div>
  <div class="grid-right-code">
    <div class="content">
      <p>
        Finally, the conditional check on the person&rsquo;s login date can be understood instantly, instead of having to parse (even if for a brief moment) through the date math.
      </p>
    </div>
    <div class="code-block">
<pre>
if (person.MinutesIdle > 60)
{
  // Log out and send to the login screen.
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        The best part of this work is that, once you get accustomed to the game, it&rsquo;s not a heavy effort. It actually becomes a bit addictive. You can make these simple refactorings quickly and stop whenever the time you&rsquo;ve devoted is up (or your manager comes back from lunch).
      </p>
      <hr />
      <p>
        Keep hunting for places where you can corral bits of logic into meaningful names, whether as standalone properties or back into the objects they derived from. It will do wonders for the clarity of your code.
      </p>
    </div>
  </div>
</div>


<div class="chapter" id="ch-breaking-methods-apart">
  <div class="grid-content">
    <div class="content">
      <h2>Breaking Methods Apart</h2>
      <p class="emphasis">
        As you add more parameters to a method, two problems tend to occur.
      </p>
      <p>
        First, the method starts doing too much. There might be tricky conditional logic that would be better separated into their own methods. Second, the name of the method becomes increasingly more vague or more misleading. Whenever I&rsquo;ve augmented a method to support a new feature, I revisit it to see if breaking it apart can help alleviate both problems&mdash;even if the updates seem miniscule.
      <hr />
      <p>
        For years, DoneDone has only allowed customers the option to cancel an account immediately&mdash;it was instantaneous and irreversible. 
      </p>
    </div>
  </div>

  <div class="grid-right-code">
    <div class="content">
      <p>
        I have a method off of a billing repository class that&rsquo;s responsible for invoking the cancellation when requested. The guts of the method are involved, but <a href="#" class="code-ref" data-code-ref="4-d1">the method signature</a> is about as simple a read as you can imagine.
      </p>
    </div>
    <div class="code-block">
      <pre>
public class BillingRepository
{
  <span class="4-d1">public void CancelAccount(int account_id)</span> { ... };
  ...
}</pre>
    </div>
  </div>
  
  <div class="grid-content">
    <div class="content">
      <p>
        Over the years, we&rsquo;ve had customers who&rsquo;ve wanted to cancel their account at the end of their term which could be several months out. Rather than remembering to cancel their account in a few months, they wanted the account to automatically cancel on the last day of their term. 
      </p>
      <p>
        I start implementing this by tacking on a parameter to <code>CancelAccount()</code>. Since there are now two cancellation options, cancelling immediately <em>or</em> at the end of their current billing period, I choose the simplest parameter type that fills the need, the trusty boolean. 
      </p>
      <p>
        <a href="#" class="code-ref" data-code-ref="4-d11">I decide to name it <code>cancel_at_period_end</code></a>. Now, I can pass in <code>true</code> to handle this new special case, and <code>false</code> to handle the original case.
      </p>
    </div>
  </div>

  <div class="grid-code-only">
    <div class="code-block">
      <pre>
public void CancelAccount(int account_id, <span class="4-d11">bool cancel_at_period_end</span>);
</pre>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <p>
       After I&rsquo;ve implemented the new code to handle the update, I then update <a href="#" class="code-ref" data-code-ref="4-d12">all existing references</a> to this method that handle the immediate cancellations.
      </p>
    </div>
  </div>

  <div class="grid-code-only">
    <div class="code-block">
      <pre>
_billing.CancelAccount(account_id, <span class="4-d12">false</span>);
</pre>
    </div>
  </div> 

  <div class="grid-content">
    <div class="content">
      <p>
        But something doesn&rsquo;t feel right about this method signature.
      </p>
      <p>
        At a glance, it&rsquo;s hard to tell what the <code>false</code> parameter means. Having just written the updates, it makes sense to me now. But it might not to someone else (or to myself in a few days). They&rsquo;ll have to look at the method signature and perhaps even drill into the method to be sure. 
      </p>
      <p>
        <a href="#" class="code-ref" data-code-ref="4-d2">I add a comment above each call to <code>CancelAccount()</code></a> for clarity.  It also helps differentiate between the new code I&rsquo;ll be adding later to handle the new option of canceling at the end of the period.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
<span class="4-d2">// Cancel the account immediately...</span>
_billing.CancelAccount(account_id, false);</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        <em>Better</em>. But comments never age well. The method call still feels strange. The standard cancellation case (canceling immediately) accepts the <code>false</code> parameter. Passing in <code>false</code> as the base case just feels odd&mdash;it&rsquo;s as if I have to suppress something to perform the <em>default</em> action.
      </p>
      <p>
        I can get around this pretty quickly though. Since I&rsquo;m working with a boolean parameter, I can change its meaning so that the standard case passes in <code>true</code> and update my code accordingly.
      </p>
    </div>
  </div>

  <div class="grid-right-code">
    <div class="content">
      <p>
        <a href="#" class="code-ref" data-code-ref="4-d3">I swap the <code>cancel_at_period_end</code> parameter with <code>cancel_now</code></a> and <a href="#" class="code-ref" data-code-ref="4-d4">modify the implementation</a>.
        Now, the default case passes in <code>true</code>. 
      </p>
    </div>
    <div class="code-block">
<pre>
public void CancelAccount(int account_id, <span class="4-d3">bool cancel_now</span>) { ... }

...

// Cancel the account immediately...
_billing.CancelAccount(account_id, <span class="4-d4">true</span>);</pre>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <p>
        But, I&rsquo;ve introduced a more onerous problem. By simply reading the <code>CancelAccount()</code> method signature, I can&rsquo;t quite tell what passing in <code>false</code> would do. Would it cancel in a day? In a month? At the end of the period? 
      </p>
      <p>
        At this point, I&rsquo;ve exhausted my options with the boolean parameter. While it allows for both options, the options aren&rsquo;t clear from the method signature.
      </p>
      <p>
        I often find this is the case with booleans when the concept it describes has two cases but the options aren&rsquo;t really <em>opposites</em>. That&rsquo;s the case here&mdash;the natural opposite of <code>cancel_now</code> isn&rsquo;t <code>cancel_at_period_end</code> in the way the natural opposite of <code>open</code> is <code>closed</code>.
      </p>
      <p>
        <a href="#" class="code-ref" data-code-ref="4-d5">I could try introducing an enumerated value instead</a>.
      </p>
    </div>
  </div>

  <div class="grid-code-only">
    <div class="code-block">
    <pre>
<span class="4-d5">enum CancelType 
{
  NOW,
  AT_PERIOD_END
}</span>
...

public void CancelAccount(int account_id, <span class="4-d5">CancelType cancel_type</span>);

...

_billing.CancelAccount(account_id, <span class="4-d5">CancelType.NOW</span>);</pre>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <p>
        This is an improvement. On the plus side, I&rsquo;ve gotten rid of the ambiguity issues I had with the boolean parameter. It also leaves me better positioned to introduce additional cancelation types in the future.
      </p>
      <p>
        However, this just doesn&rsquo;t feel like one of those features we&rsquo;d continually augment in the near future. There just aren&rsquo;t that many variations of canceling DoneDone that would make sense. And, now I&rsquo;ve introduced a new type as well as a new parameter.
      </p>
      <p>
        I ultimately decide to simplify things. I create two distinct cancelation methods and convey the type of cancelation in the <a href="#" class="code-ref" data-code-ref="4-d51">method names</a>. 
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
    <pre>
public void <span class="4-d51">CancelAccountNow</span>(int account_id);
public void <span class="4-d51">CancelAccountAtPeriodEnd</span>(int account_id);</pre>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <p>
        With this update, the standard and unique cancelation implementations both read clearly. There&rsquo;s zero ambiguity in either what the method does or what the parameters mean.
      </p>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        I also get an additional benefit. Breaking the method out into two methods allows me to separate the implementations of each. In the original approach, I&rsquo;d have to do something like this.
      </p>
    </div>
  </div>

  <div class="grid-left-code">
    <div class="content">
      <p> 
        The method body would not only be much longer, but it would have more than one responsibility. Breaking the methods apart not only clarify their use, but will make finding and updating their implementations easier down the road.
      </p>
    </div>
    <div class="code-block">
<pre>
void CancelAccount(int account_id, bool cancel_at_period_end)
{
  if (cancel_at_period_end)
  {
    // Implementation for canceling at period end
  }
  else
  {
    // Implementation for canceling immediately
  }
}
</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <hr />
      <p>
        I find a similar opportunity arises when <code>null</code> values are passed to a method. I can usually a new method to handle the <code>null</code> case with a much clearer name.
      </p>
      <p>
        In DoneDone, I have a series of &ldquo;bulk edit&rdquo; methods that live in a services layer. Each accepts a list of <code>task_ids</code> and performs some action on the task they represent. One of these is a function to bulk update the tasks&rsquo; due dates. 
      </p>
      <p>
        Here&rsquo;s the abbreviated signature. (Due dates are optional&mdash;hence the nullable <code>DateTime?</code> object representing the due date in the parameter list.)
      </p>
    </div>
  </div>
  
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
public void UpdateDueDates(List&lt;long&gt; task_ids, DateTime? due_date, ...);</pre>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <p>
        Crawling up to the application layer, here&rsquo;s where <a href="#" class="code-ref" data-code-ref="4-d6">I call the bulk edit due date method</a> based on the user&rsquo;s input:
      </p>
    </div>
  </div>

  <div class="grid-code-only">
    <div class="code-block">
<pre>
switch (input.ActionChangeType)
{
  case BulkActions.UPDATE_DUE_DATE:
    <span class="4-d6">_service.UpdateDueDates(input.TaskIDs, DateTime.Parse(input.Value),...);</span>
    break;
    ... 
}</pre>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <p>
        In a recent feature update, we wanted to explicitly add an option to <em>remove</em> due dates from all tasks. Because the <code>UpdateDueDates()</code> method already gives the option to pass in a <code>null</code> value, <a href="#" class="code-ref" data-code-ref="4-d7">the update is straightforward</a>:
      </p>
    </div>
  </div>

  <div class="grid-code-only">
    <div class="code-block">
<pre>
switch (input.ActionChangeType)
{
  case BulkActions.UPDATE_DUE_DATE:
    _service.UpdateDueDates(input.ItemIDs, DateTime.Parse(input.Value), ...);
    break;
        
  <span class="4-d7">case BulkActions.REMOVE_DUE_DATE:
    _service.UpdateDueDates(input.ItemIDs, null, ...);
    break;</span>
    ... 
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        But, explicitly passing <code>null</code> makes the code less readable. When I  revisit this line of code down the road, I have to trickle into the method to be certain of what <code>null</code> refers to. So why not eliminate the need altogether?
      </p>
      <p>
        Back on the service layer, I create a new method specifically for removing due dates that wraps the original <code>UpdateDueDates()</code> method. And once again, I can give it a <a href="#" class="code-ref" data-code-ref="4-d8">more meaningful name</a>: <code>RemoveDueDates()</code>.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
  <pre>
public void <span class="4-d8">RemoveDueDates</span>(List&lt;long&gt; task_ids, ...)
{
  UpdateDueDates(task_ids, null, ...);
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        With this small addition, I can tidy up the application layer code. In context, <a href="#" class="code-ref" data-code-ref="4-d10">the two actions around due dates are now much easier to parse</a>.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
<pre>
switch (input.ActionChangeType)
{
  case BulkActions.UPDATE_DUE_DATE:
    <span class="4-d10">_service.UpdateDueDates(input.TaskIDs, DateTime.Parse(input.Value), ...);</span>
    break;
        
  case BulkActions.REMOVE_DUE_DATE:
    <span class="4-d10">_service.RemoveDueDates(input.TaskIDs, ...);</span>
    break;
    ... 
}</pre>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <hr />
      <p>
        In both examples, adding a <em>new</em> method rather than relying on the parameters of an existing method were fairly easy decisions. In both cases, there was only one variant to the parameters, requiring one additional method.
      </p>
      <p>
        If the amount of variations are small (say, three or less), and these variations are unlikely to change over time, creating new methods that take the place of a parameter makes a whole lot of sense to improve your code readability.
      </p>
    </div>
  </div>
</div>

<div class="chapter" id="ch-shape-of-code">
  <div class="grid-content">
    <div class="content">
      <h2>The Shape of Code</h2>
      <p class="emphasis">
        Code has a certain <em>shape</em> to it. Its spacing. The indentations. Where line breaks are made. All of this stuff matters.
      </p>
      <p>
        Good shape makes code easier&mdash;and more enjoyable&mdash;to read. So, at times, my reason for naming something is unapologetically superficial: It might have more to do with the code&rsquo;s shape than the meaning of the name.
      </p>
      <p>
        Consider this simple <code>for</code> loop.
      </p>
    </div>
  </div>

  <div class="grid-right-code">
    <div class="code-block">
      <pre>
for (int i=0; i < <span class="5-d1">tokens</span>.length; i++)
{
  if (<span class="5-d2">tokens[i].Used</span>)
  {
    <span class="5-d3">usedTokens.Add(tokens[i]);</span>
  }
}</pre>
    </div>
    <div class="content">
      <p>
        To me, this code has good shape. The importance of the variables are roughly equal to their size. When I read this code, it doesn&rsquo;t take me long to figure out that there is a <a href="#" class="code-ref" data-code-ref="5-d1"><code>tokens</code> array</a>, and <a href="#" class="code-ref" data-code-ref="5-d2">used tokens</a> in that array are added to <a href="#" class="code-ref" data-code-ref="5-d3">a <code>usedTokens</code> list</a>. 
      </p>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <p>
        Here&rsquo;s that same code block again with one name change. Instead of using the generic variable name <code>i</code>, I substitute it with a much more precise name, <a href="#" class="code-ref" data-code-ref="5-d4"><code>curIndexOfTokenArray</code></a>.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
for (int <span class="5-d4">curIndexOfTokenArray</span>=0; <span class="5-d4">curIndexOfTokenArray</span> < <span class="5-d5">tokens</span>.length; <span class="5-d4">curIndexOfTokenArray</span>++)
{
 if (<span class="5-d5">tokens</span>[<span class="5-d4">curIndexOfTokenArray</span>].Used)
 {
   <span class="5-d5">usedTokens</span>.Add(<span class="5-d5">tokens</span>[<span class="5-d4">curIndexOfTokenArray</span>]);
 }
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        If I think only in terms of clarity, then the code should be an improvement. Certainly,  
        <a href="#" class="code-ref" data-code-ref="5-d4"><code>curIndexOfTokenArray</code></a> is clearer than <code>i</code>. But, is it <em>better</em>? 
      </p>
      <p>
        While the current index is a critical anchor of a <code>for</code> loop, representing it in a verbally meaningful way isn&rsquo;t. For one thing, an index is common to <em>every</em> kind of <code>for</code> loop. In addition, its scope is small&mdash;it only exists within the small loop. If someone were really confused about the variable name, they&rsquo;d only need to look around a small visual radius to get re-familiarized.
      </p>
      <p>
        The stars of the show here ought to be the <code>tokens</code> array and <code>usedTokens</code> list. Adding more description to <code>i</code> brings a peripheral stage crew member into the spotlight. The lines are altogether more difficult to digest&mdash;a whole lot of verbosity to explain something quite simple.
      </p>
      <p>
        The original version values the shape of the entire statement over the specificity of the variable name. There are certain times where this is a better trade-off. This is one of them.
      </p>
      <hr />
      <p>
        Here&rsquo;s another example. In DoneDone, <code>systemTimeZones</code> represent a collection of objects each describing a time zone. The method below loops through this collection, then extracts time zone information <a href="#" class="code-ref" data-code-ref="5-d50">to build a list of <code>DropDownComponents</code></a> while <a href="#" class="code-ref" data-code-ref="5-d51">marking the passed-in time zone as <code>Selected</code></a>:
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
<pre>
public List&lt;DropDownComponent&gt; BuildTimeZonesDropDownList(string selected_time_zone)
{
  var result  = new List&lt;DropDownComponent&gt;();
  var systemTimeZones = TimeZoneInfo.GetSystemTimeZones();

  foreach (var systemTimeZone in systemTimeZones)
  {
    <span class="5-d50">var comp = new DropDownComponent(systemTimeZone.Id, systemTimeZone.DisplayName);</span>

    <span class="5-d51">comp.Selected = (systemTimeZone.Id == selected_time_zone);</span>

    result.Add(comp);
  }

  return result;
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        The immediate problem with this code is how repetitive some of the variable names look. There are several names in this method that all look similar at a glance:
      </p>
      <ul>
        <li>The <code>systemTimeZones</code> collection</li>
        <li>The <code>systemTimeZone</code> object scoped in the <code>foreach</code> loop</li>
        <li>The <code>selected_time_zone</code> parameter</li>
        <li>The <code>GetSystemTimeZones()</code> method call.</li>
      </ul>
      <p>
        Scenarios like these are tricky because each name, in isolation, is appropriately descriptive. No single name is egregiously lengthy, misleading, or overly detailed. 
      </p>
      <p>
        The problem, however, is when we step back and read the method as a whole. It reminds me a lot of the lines of a Dr. Suess story. One of my kids&rsquo; favorites is <em>Hop On Pop</em>, which begins:
      </p>
      <blockquote>
        UP PUP - Pup is up.<br />
        CUP PUP - Pup in cup.<br />
        PUP CUP - Cup on pup.<br />
      </blockquote>
      <div class="quoter">Dr. Seuss, <em>Hop on Pop</em></div>
      <p>
        The lines of Dr. Seuss, of course, are intentionally dizzying. My kids love to get lost in the pattern of the words and giggles at the absurdity of its rhythm. But, reading dizzying code at 5pm isn&rsquo;t that fun. For this, I need to make some name improvements.
      </p>
      <p>
        The most immediate and impactful name change I can make is with the name of the <code>systemTimeZone</code> object. It appears four times within the method; No other similarly named construct appears more than twice. Also, because its reach is small (only scoped to the <code>foreach</code> loop), I can get away with a less descriptive name without doing much harm to the reader&rsquo;s understanding. 
      </p>
      <p>
        I try <a href="#" class="code-ref" data-code-ref="5-d6">reducing <code>systemTimeZone</code> to something shorter, like <code>tz</code></a>:
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
<pre>
public List&lt;DropDownComponent&gt; BuildTimeZonesDropDownList(string selected_time_zone)
{
  var result  = new List&lt;DropDownComponent&gt;();
  var systemTimeZones = TimeZoneInfo.GetSystemTimeZones();

  foreach (var <span class="5-d6">tz</span> in systemTimeZones)
  {
    var component = new DropDownComponent(<span class="5-d6">tz</span>.Id, <span class="5-d6">tz</span>.DisplayName);

    <span class="5-d6">comp.Selected = (tz.Id == selected_time_zone);</span>

    result.Add(component);
  }

  return result;
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        I like this change already. Now, the details of the <code>foreach</code> loop are much easier to scan. In addition, all of the other similarly-named constructs benefit. They&rsquo;re given more room so that the similarity in their names aren&rsquo;t as distracting on the eyes as they were before.
      </p>
      <p>
        Just like in the prior example, the variable <code>tz</code> feels sized appropriately. Conceptually, a small name like <code>tz</code> feels like just one element in a longer-named collection like <code>systemTimeZones</code>. These are the kinds of subtle visual cues that all lend themselves to good code shape.
      </p>
      <p>
        Next, I decide to <a href="#" class="code-ref" data-code-ref="5-d71">pare down the variable <code>systemTimeZones</code> to just <code>timeZones</code></a>. I originally named this list <code>systemTimeZones</code> to follow how the .NET framework named the method I&rsquo;m using (<code>GetSystemTimeZones()</code>). But, the word <em>system</em> doesn&rsquo;t add any helpful meaning here. This change also helps better <a href="#" class="code-ref" data-code-ref="5-d72">differentiate it from the <code>selectedTimeZone</code>
        variable</a> used inside the <code>foreach</code> loop.
      </p>
    </div>
  </div>
 <div class="grid-code-only">
    <div class="code-block">
      <pre>
public List&lt;DropDownComponent&gt; BuildTimeZonesDropDownList(string selected_time_zone)
{
  var result  = new List&lt;DropDownComponent&gt;();
  var <span class="5-d71">timeZones</span> = TimeZoneInfo.GetSystemTimeZones();

  foreach (var tz in <span class="5-d71">timeZones</span>)
  {
    var component = new DropDownComponent(tz.Id, tz.DisplayName);

    comp.Selected = (tz.Id == <span class="5-d72">selected_time_zone</span>);

    result.Add(component);
  }

  return result;
}
</pre>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <p>
        I could go further and rename the other variables more uniquely, but I don&rsquo;t feel it&rsquo;s necessary. When I read the updated method, the dizzying effect is gone. Mission accomplished.
      </p>
      <hr />
      <p>
        One last example. In DoneDone, there are places where I write code to build up larger segments of text. For instance, I use a <code>StreamWriter</code> to generate documentation for our API and a <code>StringBuilder</code> to write lines of dynamic text into an email object.
      </p>
      <p>
        Here&rsquo;s a case where I&rsquo;ve used a <code>Document</code> object to build up our search catalog. The search catalog library I&rsquo;m using is a port of the well-known Java search library <em>Lucene</em>, so naturally, a name like <code>lucene_document</code> feels appropriate here. Here&rsquo;s a bit of the code snippet that builds
        an instance of <code>Document</code> before it&rsquo;s added to the search catalog:
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
var lucene_document = new Document();

lucene_document.Add(new Field(_FIELD_item_event_id, item_event.ItemEventID...);
lucene_document.Add(new Field(_FIELD_item_id, item_event.ItemID....);
lucene_document.Add(new Field(_FIELD_project_id, item_event.ProjectID...);
lucene_document.Add(new Field(_FIELD_creator_id, item_event.CreatorID...);
lucene_document.Add(new Field(_FIELD_created_on, item_event.CreatedOn...);
lucene_document.Add(new Field(_FIELD_is_convo_thread, item_event.IsConvoThread...);
lucene_document.Add(new Field(_FIELD_is_non_convo_creation, item_event.IsNonConvoCreation...);
lucene_document.Add(new Field(_FIELD_item_title, item_event.Title...);
lucene_document.Add(new Field(_FIELD_item_event_desc, item_event.PlainTextDescription...);
      </pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        Is it specific? Yes. But, at a glance, the name <code>lucene_document</code> is overwhelming. It pushes the interesting part of the code further to the right without adding much information. I decide to trim this name down to something much smaller, like <code>doc</code>.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
var doc.Add = new Document();

doc.Add(new Field(_FIELD_item_event_id, item_event.ItemEventID...);
doc.Add(new Field(_FIELD_item_id, item_event.ItemID....);
doc.Add(new Field(_FIELD_project_id, item_event.ProjectID...);
doc.Add(new Field(_FIELD_creator_id, item_event.CreatorID...);
doc.Add(new Field(_FIELD_created_on, item_event.CreatedOn...);
doc.Add(new Field(_FIELD_is_convo_thread, item_event.IsConvoThread...);
doc.Add(new Field(_FIELD_is_non_convo_creation, item_event.IsNonConvoCreation...);
doc.Add(new Field(_FIELD_item_title, item_event.Title...);
doc.Add(new Field(_FIELD_item_event_desc, item_event.PlainTextDescription...);
      </pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        Now, the code feels less cluttered. The interesting parts are quicker to get to. It&rsquo;s much easier to consume.
      </p>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <hr />
      <p>
        When you edit names, don&rsquo;t look at them in isolation. That habit can drive naming decisions that actually harm the overall readability of the surrounding code. 
      </p>
      <p>
        Instead, look at the context in which these names live. Find out what makes a section of code difficult to read and solve the larger problem. It might be a more descriptive variable name, but it might also be a terse one. Let the full context drive those decisions.
      </p>
      <p>
        In the previous examples, I didn&rsquo;t value the precision of certain variable names as much as I did the shape of the lines around them, particularly because the scope of those variables was small or the extra precision added little context.
      </p>
      <p>
        When editing prose, you read whole sentences and paragraphs to get a sense of readability and style. I find code writing to be similar.
      </p>
    </div>
  </div>
</div>

<div class="chapter" id="ch-when-opposites-confuse">
  <div class="grid-content">
    <div class="content">
      <h2>When Opposites Confuse</h2>
      <p class="emphasis">
        The English language has enough breadth that most words have a clear opposite.
      </p>
      <p>
        For a piece of functionality that allows you to move a file out of the trash, you don&rsquo;t have to say <em>undelete</em>; <em>Restore</em> makes perfect sense. It&rsquo;s clear that a file that can be restored has already been deleted or removed.
      </p>
      <p>
        But, sometimes finding the opposite isn&rsquo;t always straightforward.
      </p>
      <hr />
      <p>
        We have a new concept in DoneDone called <em>workflows</em>. A workflow defines a series of statuses available for a task. A typical workflow might have statuses like &ldquo;Open&rdquo;, &ldquo;In Progress&rdquo;, &ldquo;Not Reproducible&rdquo;, &ldquo;Closed&rdquo; and so forth. We let users create workflows to tailor them to their particular business processes. 
      </p>
      <p>
        A workflow has its own status too. It starts as <em>unpublished</em>. When you&rsquo;re ready to use the workflow on a project, you must <em>publish</em> it. Simple enough.
      </p>
      <p>
        But, once a workflow is published, you can still <em>unpublish</em> the workflow. There are a few caveats to this, so I decide to wrap this logic inside of a convenient little method in the <code>Workflow</code> class. My first attempt at a method name is <code>IsWorkflowUnpublishable()</code>.
      </p>
      <p>
        Quickly, I realize there&rsquo;s something unsavory about this name. Someone could easily mistake this name to mean that a workflow <em>cannot be published</em> rather than that a workflow <em>can be unpublished</em>. Those are, of course, two very different things.
      </p>
      <p>
        The problem is that there just isn&rsquo;t a good adjective that means the opposite of published. <em>Draft</em> might be the best way to describe this concept. It&rsquo;s something I&rsquo;ve seen before in blogging tools for instance. But a method name like <code>IsWorkflowDraftable()</code> or <code>IsWorkflowAbleToBeInDraftMode()</code> feels like I&rsquo;m headed in the wrong direction fast.
      </p>
      <p>
        In cases like this, I look for a completely different angle to the name. After staring at my options for a few minutes, I realize the obstacle lies with the prefix <em>isWorkflow</em>. It forces me into having to come up with an adjective to describe the state of the workflow I want to achieve&mdash;and there aren&rsquo;t any good ones that make the method name read clearly.
      </p>
      <p>
        Instead of starting the name with the adjective-requiring &ldquo;is&rdquo;, I start with the verb-requiring &ldquo;can&rdquo; and come up with <code>CanUnpublishWorkflow()</code>.
      </p>
      <p>
        Now I might be onto something! Notice I still use the word <em>unpublish</em>, but as a verb the intent is no longer ambiguous. It&rsquo;s clear we are checking whether this <em>workflow can be unpublished</em> as opposed to checking whether the <em>workflow can&rsquo;t be published</em>.
      </p>
      <hr />
      <p>
        If the opposite version of a name makes it ambiguous, instead of pushing harder on finding a different name, see if you can reword it altogether. You might already have all the pieces you need without knowing it.
      </p>
    </div>
  </div>
</div>

<div class="chapter" id="ch-tautologous-name-trap">
  <div class="grid-content">
    <div class="content">
      <h2>The Tautologous Name Trap</h2>
      <p class="emphasis">
        The French philosopher Ren&#233; Descartes once said &ldquo;I am, therefore I am.&rdquo; What makes for a great philosophical statement to ponder also makes for an unhelpful line of code to read.
      </p>
      <hr />
      <p>
        I&rsquo;m working on a piece of code that processes incoming emails for DoneDone. One of its responsibilities is to send an auto-response email back to the original sender if certain conditions are met.
      </p>
      <p>
        In the first iteration of this feature, I send the auto-response only if the email was received outside of a company&rsquo;s office hours. 
        I write a method named <code>isCurrentlyOutsideOfficeHours()</code> which queries the company&rsquo;s work hours and figures out if the current time falls outside of them. 
      </p>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        In my incoming email handler, I call this method to determine if DoneDone should send an auto-response.
      </p>
    </div>
  </div>

  <div class="grid-code-only">
    <div class="code-block">
      <pre>
if (isCurrentlyOutsideOfficeHours()) 
{
  sendAutoResponse();
}</pre>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <p>
        The method name <code>isCurrentlyOutsideOfficeHours()</code> makes the conditional statement read coherently. Even a non-programmer can read the statement above and guess what it does: &ldquo;If it is currently outside of the office hours, then send an auto-response.&rdquo;
      </p>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        Suppose sometime later we decide to allow users to configure company holidays as well as office hours. This way, the auto-response will always be triggered during a company holiday regardless of the time of day.
      </p>
    </div>
  </div>

  <div class="grid-left-code">
    <div class="content">
      <p>
       Back under the hood, I add the new functionality. Now, the check for whether to send the auto-response has <a href="#" class="code-ref" data-code-ref="7-d1">this new condition</a>.
      </p>
    </div>
    <div class="code-block">
      <pre>
if (isCurrentlyOutsideOfficeHours() <span class="7-d1">|| isCompanyHoliday()</span>) 
{ 
  sendAutoResponse(); 
}</pre>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <p>
        Because I&rsquo;ve added more complexity to the auto-response logic, I might push the conditional expression into its own method and call the new method in place of the expression. At first, a name like <code>shouldSendAutoResponse()</code> sounds completely sensible. Here&rsquo;s what that would look like:
      </p>
    </div>
  </div>

  <div class="grid-code-only">
    <div class="code-block">
      <pre>
private bool shouldSendAutoResponse()
{
  return isOutsideOfficeHours() || isCompanyHoliday();
}</pre>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <p>
        With a new property extracted, I can replace the original conditional so my code is tidy again. 
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
if (shouldSendAutoResponse()) 
{ 
  sendAutoResponse(); 
}</pre>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <p>
        But, do you spot the new problem? Descartes might. The statement, while tidy, has lost all of its meaning. Of course we send the auto-response if we should send the auto-response!
      </p>
      <p>
        When you read the conditional in isolation, you don&rsquo;t know <em>why</em> the auto-response is being sent. You need to trickle into the <code>shouldSendAutoResponse()</code> method to find out. The extraction doesn&rsquo;t give us better comprehension&mdash;it just tucks away logic.
      </p>
      <p>
        I find this happens a lot with these quick extraction exercises. My immediate inclination is to name the newly extracted property after the <em>outcome</em> of the conditions being met rather than the <em>meaning</em> of the conditions. I name the property after the <em>effect</em> rather than the <em>cause</em>.
      </p>
      <p>
        Not only does this create tautalogous statements, but it&rsquo;s less likely I&rsquo;ll reuse the new construct somewhere else. At a glance, I wouldn&rsquo;t think to employ <code>shouldSendAutoResponse()</code> anywhere else besides the place in code where I want to send auto-responses. If I had named the method after what <em>causes</em> the sending of the auto-response, I better my chance of reuse later.
      </p>
      <p>
        So, why are we sending the auto-response? In this case, the cause of sending an auto-response message is because <em>the office is closed</em>. Let&rsquo;s try that.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
bool isOfficeClosed()
{
  return isOutsideOfficeHours() || isCompanyHoliday();
}

...

if (isOfficeClosed()) 
{ 
  sendAutoResponse(); 
}</pre>  
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
      The conditional now reads much more meaningfully. In addition, <code>isOfficeClosed()</code> is a method that has far more obvious applications than <code>shouldSendAutoReponse()</code> does. 
      </p>
      <hr />
      <p>
      Tautologous conditionals aren&rsquo;t necessarily bad, though. There are times where describing the <em>effect</em> is the cleanest option. Let&rsquo;s continue with this example. 
      </p>
      <p>
      Suppose that we introduce a few more conditions to determine whether to send an auto-response. Namely, we let an account toggle auto-responses altogether and we also want to exclude auto-responses to emails that are flagged as spam. My first step is to <a href="#" class="code-ref" data-code-ref="7-d2">augment the conditional</a> one more time.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
if (isOfficeClosed() <span class="7-d2">&& autoResponseEnabled && !_email.IsSpam</span>) 
{ 
  sendAutoResponse(); 
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        The conditional expression bloats up again&mdash;it seems ripe for packaging things up. But, I have trouble finding an elegant solution. Is there a meaningful name that could consolidate all (or some) of the expression <code>isOfficeClosed()</code>, <code>autoResponseEnabled</code>, and <code>!_email.IsSpam</code>? There doesn&rsquo;t appear to be a common relationship other than they all factor into sending an auto-response.
      </p>
    </div>
  </div>

  <div class="grid-left-code">
    <div class="content">
      <p>
        I can either leave things as is, or name the entire expression for what it affects. <a href="#" class="code-ref" data-code-ref="7-d3">In this case, I choose the latter</a>.
      </p>
      <p>
        I live with the <a href="#" class="code-ref" data-code-ref="7-d4">tautologous statement</a> to keep the code succinct, even though I&rsquo;m unlikely to reuse this method elsewhere.
      </p>
    </div>
  <div class="code-block">
    <pre>
bool isOfficeClosed()
{
  return isOutsideOfficeHours() || isCompanyHoliday();
}

<span class="7-d3">bool shouldSendAutoResponse()
{
  return isOfficeClosed() && autoResponseEnabled && !_email.IsSpam;
}</span>

<span class="7-d4">if (shouldSendAutoResponse()) 
{ 
  sendAutoResponse(); 
}</span></pre>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <hr />
      <p>
        I make tradeoffs with names depending on how a section of code evolves. When I can find an appropriate name for the <em>cause</em>, I choose it. When I can&rsquo;t, I might decide that naming an extraction for its <em>effect</em> is still better than not extracting it at all.
      </p>
    </div>
  </div>
</div>


<div class="chapter" id="ch-names-are-fickle">
  <div class="grid-content">
    <div class="content">
      <h2>Names are Fickle</h2>
      <p class="emphasis">
        Keeping a codebase with well-intentioned names is often just about <em>remembering</em> to do so. 
      </p>
      <p>
        Every time I make a change to a codebase, I reconsider the names of all the pieces I touched. It&rsquo;s easy to leave working code as-is without considering the debt I&rsquo;ve just handed over to the next person reading this code. 
      </p>
      <hr />
      <p>
        Awhile back, I had a method that updated various pieces of account data, which I aptly named <code>UpdateAccountInfo</code>:
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
public void UpdateAccountInfo(int account_id, string account_name, int owner_id, byte[] logo) { ... }</pre>
      </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        As you can probably tell by the signature, this method lets you change the name, owner, and logo tied to the account with the passed-in <code>account_id</code>.
      </p>
      <p>
        At some point, it became advantageous to handle the uploading of the logo somewhere else. As part of this update, I pulled the <code>logo</code> parameter out of this method.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
public void UpdateAccountInfo(int account_id, string account_name, int owner_id) { ... }</pre>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <p>
        Now, we want to allow for accounts to have multiple owners. Since the change is fairly large, I decide it best to manage owners in an entirely separate part of the application. Part of this update naturally requires removing the <code>owner_id</code> from this method&rsquo;s signature.
      </p>
    </div>
  </div>

  <div class="grid-code-only">
    <div class="code-block">
      <pre>
public void UpdateAccountInfo(int account_id, string account_name) { ... }</pre>
    </div>
  </div>

  <div class="grid-content">
    <div class="content">
      <p>
        In the flurry of updating code, I might leave <code>UpdateAccountInfo()</code> named as is. But, stripped of most of its original responsibilities, the name doesn&rsquo;t feel right anymore. It would be much more precise to rename it <code>UpdateAccountName()</code>&mdash;that&rsquo;s all it&rsquo;s doing anymore. It also doesn&rsquo;t hurt to shorten the parameters <code>account_id</code> and <code>account_name</code> to just <code>id</code> and <code>name</code>, since it&rsquo;s obvious at this point what those parameter refer to.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
public void UpdateAccountName(int id, string name) { ... }</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <hr />
      <p>
        This change sounds obvious to make, but it&rsquo;s only because I&rsquo;ve isolated the discussion of what changed to just this lone method&mdash;not the myriad of method additions, refactorings, and adjustments that come as a natural part of every kind of change we make to our code.
      </p>
      <p>
        After you move code around your application to get the pieces fitting just right, revisit how you&rsquo;ve named the methods, properties, and classes that have undergone the facelift. Do these names still make sense? Do the comments around these methods still apply?
      </p>
      <blockquote>
        &ldquo;One of the biggest sins you can commit is to stop programming when it works.&rdquo;
      </blockquote>
      <div class="quoter">
        Brandon Rhodes, <a href="https://www.youtube.com/watch?v=YklKUuDpX5c">PyCon 2013</a>
      </div>
      <p>
        When you&rsquo;re in the same code daily, you might not even notice that the name of a variable or method is antiquated because you&rsquo;re so familiar with it. But, to someone coming into the codebase fresh (or, if you happen to take a few weeks off and come back to it later), misleading names become huge hurdles to their understanding of the system.
      </p>
      <p>
        Nothing will automatically remind you to do this but your own habits. There won&rsquo;t be a failed unit test or compiler warning telling you that a construct&rsquo;s name is no longer relevant. That&rsquo;s why even well-tested code atrophies over time. Good semantics are not something you get for free.
      </p>
    </div>
  </div>
</div>

<div class="chapter" id="ch-abstracting-too-soon">
  <div class="grid-content">
    <div class="content">
      <h2>Abstracting Too Soon</h2>
      <p class="emphasis">
        Changing software architecture is a bit like driving a stick shift.
      </p>
      <p>
        When the codebase is small and the features are light, I can write concretely. But, as features evolve, I begin to introduce abstractions as a way of absorbing the complexities of the system better.
      </p>
      <p>
        Deciding when to create more abstraction is the difficult part. Like shifting gears on a car, if I abstract too slowly, the system starts to break down. Abstract too quickly, however, and it takes forever to accelerate even to the smallest degree. Knowing when the right time is requires remembering what landmarks I&rsquo;ve already passed and a little foreknowledge of what&rsquo;s coming down the road. It&rsquo;s a delicate art.
      </p>
      <p>
        Naming should also undergo the same kind of scrutiny.
      </p>
      <p>
        A crutch of mine is trying to broaden the meaning of a name too quickly. Perhaps it&rsquo;s my desparate attempt to get a name right, once and forever. But abstracting a name too soon usually inflicts more pain than comfort, just like abstracting code too soon.
      </p>
      <hr />
      <p>
        I&rsquo;m going through a refactoring in DoneDone&rsquo;s codebase to consolidate a few objects that hold very similar kinds of information, but in slightly different ways. They all revolve around the history of events that happen to a given task.
      </p>
      <p>
        Ultimately, the properties of these objects manifest in a few different places. On a task&rsquo;s detail page, the collection of events for a single task is written out from a <code>TaskDetailEvents</code> list. On the activity calendar, a list of events on a given day is extracted from a list of <code>EventHistory</code>. When someone updates a task, yet another event object, <code>TaskMessagingEvent</code>, is packaged up. A mailing service unpacks the data and formats the right bits of information to send email updates.
      </p>
      <p>
        On the surface, each of these objects looks very similar. My guess is that they could all be consolidated into one class.
      </p>
      <p>
        After a few hours of passing the code through the refactoring press, I&rsquo;ve reduced these classes into a single <code>TaskEvent</code> class that can support the needs of each of these three distinct use cases and more going forward. This also gives me an opportunity to consolidate similar names in the old objects like <code>CreatedOn</code>, <code>CreatedDate</code>, or <code>CreateDate</code> into one consistent name. I&rsquo;m feeling pretty good.
      </p>
      <p>
        In the process of this consolidation, however, I discover one particular string off of <code>TaskMessagingEvent</code> that doesn&rsquo;t have an equivalent in the other objects. It&rsquo;s currently called an <code>EmailSubjectAction</code>&mdash;a short description used as the beginning of the email subject, like "New fixer" or "Priority Update" or "Closed". 
      </p>
      <p>
        The dilemma I face here is what exactly to call this string. At present moment, it&rsquo;s <em>only</em> used by the mailing service and not by either the detail page or activity dashboard. But, since I&rsquo;ve done all the pruning to get toward a single object, I&rsquo;m compelled to come up with a name that can satisfy all future implementers if they ever needed this property. <code>EmailSubjectAction</code> feels way to specific for this consolidated object.
      </p>
      <p>
        My natural inclination is to call this something like <code>AbbreviatedAction</code>, especially because it juxtaposes nicely with the <code>Action</code> attribute that stores a more verbose description of the action (&ldquo;John Doe was assigned to fix the task&rdquo; or &ldquo;The priority was updated to Critical&rdquo;). I go with this name.
      </p>
      <p>
        But, after a few days, I find myself going back to this property name a couple of times again because I can&rsquo;t  remember exactly what <code>AbbreviatedAction</code> refers to, or what it&rsquo;s used for. I decide to comment the name to remind me it&rsquo;s only being used by the mailing service as part of the subject of the email. 
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
        <pre>
/* 
   Only being used by the mailing service right now as part of the email subject,
   but I&rsquo;m sure it will have other uses one day. 
*/
public string AbbreviatedAction
{
  get { ... }
}
    </pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        Whenever I have to remind myself what a name means, and eventually resort to a comment, there&rsquo;s a good chance I&rsquo;ve prematurely abstracted the name.
      </p>
      <p>
        Instead of finding a name that simultaneously fits anything but nothing in particular, I decide to go back to what it was originally named. If I&rsquo;m honest with myself, <code>EmailSubjectAction</code> works a lot better.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
public string EmailSubjectAction
{
  get { ... }
}
      </pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <hr />
      <p>
        You might argue that I should move this particular property to its own subclass that inherits the <code>TaskEvent</code> class. This way, I can use this subclass specifically for the emailing case. But, the overhead of managing another class just for this one unique property exposed isn&rsquo;t worth the tradeoff right now. 
      </p>
      <p>
        You might also argue that such a name might might hide the full capabilities of the property. One day, I&rsquo;ll need the very thing that <code>EmailSubjectAction</code> brings to the table&mdash;a terse description of a task action&mdash;for something entirely unrelated to emails and I will introduce an identical version of that construct and name it something else.
      </p>
      <p>
        In my experience, I find this to be the exception rather than the rule. New features are rarely developed completely isolated from anything else going on with the existing application. For instance, when we introduced in-app notifications a few months later, much of the content was inspired by what was already being displayed in our emails, including the <code>EmailSubjectAction</code>. It was far easier for me to find the property because its name hadn&rsquo;t been abstracted.
      </p>
      <p>
        At that point, because the construct was being used in multiple ways, I&rsquo; able to justify the broader name change to <code>AbbreviatedAction</code>.
      </p>
    </div>
  </div>
</div>

<div class="chapter" id="ch-speaking-the-native-tongue">
  <div class="grid-content">
    <div class="content">
      <h2>Speaking the Native Tongue</h2>
      <p class="emphasis">People that write code today are often the same ones making product decisions or collaborating directly with clients. This makes it even more critical that programmers understand why they&rsquo;re building what they&rsquo;re building. 
      </p>
      <p>One of the best ways to encourage this is to infuse the language of the business directly into your code.
      </p>
      <p>
        If I&rsquo;m building software to manage a law firm&rsquo;s organization, I want the names of my constructs to be as closely aligned to the words law professionals use to describe their own concepts. <em>Practice Areas</em> instead of <em>Topics</em>. <em>Practice Groups</em> instead of <em>Teams</em>. <em>Attorneys</em> and <em>Paralegals</em> instead of <em>Employees</em>. This way, I don&rsquo;t have to make the mental mapping between what the client calls something versus what I do.
      </p>
      <p>
        Business concepts should also drive the kind of structures you introduce into a codebase.
      </p>
      <hr />
      <p>
        If I were building a patient management system for a medical clinic, I might define a doctor&rsquo;s patient list with a structure like <code>List&lt;Patient&gt;</code>. It seems reasonable enough. I get all the normal functions associated with a <code>List</code> out-of-the-box, like <code>Add()</code>, <code>Remove()</code>, <code>Count()</code> and so forth.
      </p>
      <p>
        But, doctors typically do not call these things patient lists, they call them <em>patient panels</em>. Doctors speak to how their panels are <em>full</em> or when new spots in their panel will open up. 
      </p>
      <p>  
        Because medical professionals have defined a specific concept called panels already, it&rsquo;s almost certain there are specific attributes tied to the panel itself&mdash;not just a convenient shorthand to a list of patients. 
      </p>
      <p>
        As it turns out, panels aren&rsquo;t just assigned to doctors, but to medical assistants and health educators. Panels also have a certain optimal number of patients (so that all clinicians generally see the same number of patients). Panels can have openings or be full. It turns out there&rsquo;s a lot of other attributes tied to the concept of a panel. 
      </p>
      <p>
        What may have started out, in my mind, as a list of <code>Patient</code>s has now become something a whole lot richer.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
<pre>
public class Panel
{
  private List&lt;Patient&gt; patients;  
  
  private Doctor doctor;
  private HealthEducator healthEducator;
  private List&lt;MedicalAssistant&gt; medicalAssistants;
  
  private bool hasOpening;
  ...
}
</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>  
        To add a patient to a panel, my first sketch at a method signature might be something like:
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
    <pre>
public class Panel
{
  public void <span class="10-d1">Add(Patient p)</span>
  {
    <span class="10-d1">patients.Add(p);</span>
  }
  ...
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        Certainly, <code>Add</code> is clear, and it <a class="code-ref" href="#" data-code-ref="10-d1">follows directly from the <code>Add()</code> method associated to the <code>List</code></a>. But, doctors usually talk about patients <em>subscribing</em> to a panel. So, <a href="#" class="code-ref" data-code-ref="10-d2"><code>Subscribe</code> is a far more fluent approach</a>.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
public class Panel
{
  public void <span class="10-d2">Subscribe</span>(Patient p)
  {
    patients.Add(p);
  }
  ...
}</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        These name and construct choices seem inconsequential at first. But, as the codebase grows and the functionality gets more complex, the benefits become more significant. By naming concepts in code the way your clients and customers talk about them&hellip; 
      </p>
      <ul>
        <li>You remove an unnecessary layer of interpretation.</li> 
        <li>You can have more productive discussions with your clients.</li>
        <li>You might even be able to <em>show</em> your client working code to better explain complexities and hurdles in logic they may not have thought of.</li> 
        <li>You have a better grasp of the business concepts you have to maintain.</li>
      </ul>
      <hr />
      <p>
        Naming the <em>relationships</em> between concepts is a particular area that can be easily overlooked. For instance, if you&rsquo;re familiar with relational data modeling, you know one of the key concepts is the associative table (or associative entity).
      </p>
      <p>
        An associative table&rsquo;s core characteristic is that it contains two or more foreign keys to tables that have a &ldquo;many-to-many&rdquo; relationship. For instance, a student enrolls in multiple classes and a class can have multiple students. You might represent students in a <code>Students</code> table and another in a <code>Classes</code> table. The associative table would hold the relationship between those two tables alongside any other data relevant to that relationship (like a student&rsquo;s current grade in that class).
      </p>
      <p>
        It&rsquo;s customary to name such an associative table by gluing the adjacent table names together. This approach usually creates a platable table name like <code>StudentsClasses</code>. It reads decently.
      </p>
      <p>
        Let&rsquo;s take another example. I have an associative table that links a <code>Users</code> table with an <code>Accounts</code> table.  A user can belong to many accounts and an account can have many users. If I blindly name the associative table that links these two tables together, I&rsquo;d call it a <code>UsersAccounts</code> table.
      </p>
      <p>
        Down the road, I might track other pieces of data, like the date someone was added to the account or the particular role a user has in a specific account. Both those columns would fit naturally in the <code>UsersAccounts</code> table.
      </p>
      <p>
        But, saying &ldquo;Nora&rsquo;s user account began on March 1st, 2017&rdquo; is much less natural than saying &ldquo;Nora&rsquo;s <em>membership</em> began on March 1st, 2017&rdquo; or &ldquo;Nora&rsquo;s <em>membership</em> has admin privileges.&rdquo; The associative table is far more clear with a name like <code>Memberships</code>. 
      </p>
      <p>
        A <code>UsersPublications</code> table might be better named <code>Subscriptions</code>. A <code>CustomersProducts</code> could be a <code>PurchaseOrders</code>. A <code>PassengersFlights</code> table could be a <code>Booking</code>.
      </p>
      <p>
        And this isn&rsquo;t relegated to just table naming. Object-relational mappers usually map directly from tables, so it&rsquo;s common to see the same name patterns appear in our code&mdash; as data transfer or business domain objects. 
      </p>
      <hr />
      <p>
        The trick with good names is getting your head out of the technical details of your work and thinking about what real-world thing you&rsquo;re actually modeling. You just might find a more appropriate name that way. 
      </p>
    </div>
  </div>
</div>
</div>
</div>



<div class="chapter" id="ch-naming-and-teaching">
  <div class="grid-content">
    <div class="content">
      <h2>Naming and Teaching</h2>
      <p class="emphasis">
        Imagine you&rsquo;re teaching a new programmer about one of the most fundamental concepts in object-oriented programming&mdash;object instantiation. How would you describe an example?
      </p>
      <p>
        My first introduction to the concept was in my college &ldquo;Intro to C++&rdquo; class. Even decades later, I still recall my textbook using an example that looked similar to this:
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block large">
      <pre>
<span class="11-d1">Object</span> my<span class="11-d1">Object</span> = new <span class="11-d1">Object</span>();
my<span class="11-d1">Object</span>.<span class="11-d2">DoSomething()</span>;
</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        For an experienced programmer, this example feels like a good starting point. The names are abstract enough so you can focus on an academic discussion of class constructors and method invocation without being sidetracked by the specificity of the example. 
      </p>
      <p>
        As the student, this was not the experience I recollect. I remember staring at this line of code until the end of the class period unable to decrypt the mystery of its meaning, still struggling with what <a href="#" class="code-ref" data-code-ref="11-d1">each representation of the word <code>Object</code></a> meant, or what <a href="#" class="code-ref" data-code-ref="11-d2">possible <em>something</em></a> this object would want to do. It was maddening.
      <p>
        After all, the word <code>Object</code> appears four times in two lines. It creates that dizzying effect I discuss in <a href="#ch-shape-of-code">The Shape of Code</a>. For a programming newbie like me, this example was as clear as this syntactically correct line:
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block large">
      <pre>
Xy8lksp0 myXy8lksp0 = new Xy8lksp0();
myXy8lksp0.yXlx8x3();
</pre>
    </div>
  </div>
   <div class="grid-content">
    <div class="content">
      <p>
         If I couldn&rsquo;t grasp one of the most basic concepts in an <em>introductory-level course</em>, what hope for me was there in this industry? I was never going to be a programmer.
      </p>
      <p>
        This is the hopelessness I felt&mdash;and the hopelessness I&rsquo;m sure many others have felt when they first learned about code. I got lucky. I would learn a lot more about code over the years because I had specific needs that required me to learn concepts organically. But what about so many others that quit after that introductory class? 
      </p>
      <hr />
      <p>
        One of the easiest ways to teach code better is simple: <strong>Always use relatable names in your examples</strong>.
      </p>
      <p>
        I understand the impulse to shy away from specifics. By showing an actual application of a concept, we fear misleading the student into some myopic understanding of the <em>Big Idea</em>. The reach of the concept will never be given its due justice.
      </p>
      <p>
        It&rsquo;s this kind of false belief that has also led many of us to use metasyntactic variable names like <code>foo</code>, <code>bar</code>, <code>baz</code>, and <code>qux</code> when teaching concepts. 
      </p>
     <blockquote>
        Metasyntactic variables are used to name entities...whose exact identity is unimportant and serve only to demonstrate a concept, which is useful for teaching programming.
      </blockquote>
      <div class="quoter">
        Wikipedia entry for <a href="https://en.wikipedia.org/wiki/Metasyntactic_variable">metasyntactic variables</a>
      </div>
      <p>
        Here&rsquo;s the application of these variables to describe method overloading. 
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
void foo(int bar);
void foo(int bar, string baz);
void foo(int bar, string baz, string qux);

...

foo(0);
foo(1, "arg0");
foo(2, "arg0", "arg1");
</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        I don&rsquo;t get the sense that the meaninglessness of the variables helps teach this concept. The student, if lucky, might learn the technicalities of the concept but will certainly struggle with sensing when an occasion arises to actually use the concept.
      </p>
      <p>
        What does help immensely is concreteness. Object instantiation, method overloading, and most other programming concepts are only understandable when you apply them to something <em>real</em>. Their reason for existing only makes sense after you understand why they&rsquo;re necessary in the first place. No one will ever grasp the benefits of method overloading because passing in <code>bar</code>, <code>baz</code>, and <code>qux</code>to <code>foo()</code> produces different useful results.
      </p>
      <p>
        As I discussed in <a href="#ch-imagining-objects">Imagining Objects</a>, another teaching anti-pattern I notice is we use unrealistic scenarios as examples&mdash;dogs, cats, birds, cars, and planes. The very best examples, to me, are the ones that aren&rsquo;t only specific, but relevant to something you might actually do in code. Compare the original example of object instantiation above to an example like this.
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block large">
      <pre>
User requester = new User(username, password);
requester.Login();</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        If I showed this to someone learning the concept, they would still have many questions about the concept. But it would be much easier for me to begin explaining things like:
      </p>
      <ul>
        <li>The difference between the <code>User</code> type and the <code>User()</code> constructor method. And instead of using an empty constructor signature, I pass in variables with relatable names to better show what a constructor could do to initialize the instance.
        </li>
        <li>The difference between a class (<code>User</code>) and an instance of that class (<code>requester</code>).
        <li>An example of an appropriate method that a <code>User</code> instance might own.</li>
      </ul>
      <p>
        Similarly, I can improve the method overloading example:
      </p>
    </div>
  </div>
  <div class="grid-code-only">
    <div class="code-block">
      <pre>
void addPerson(int age);
void addPerson(int age, string first_name);
void addPerson(int age, string first_name, string last_name);

...

addPerson(27);
addPerson(34, "John");
addPerson(41, "Jane", "Smith");
</pre>
    </div>
  </div>
  <div class="grid-content">
    <div class="content">
      <p>
        Again, there will still be many questions about the concept of method overloading, but the student would have a much better grasp of the intention right out of the gate. Even a newbie could tell you what happened when each method version was invoked.
      </p>
      <ul>
        <li>A 27-year old was added.</li>
        <li>A 34-year old named John was added.</li>
        <li>A 41-year old named Jane Smith was added.</li>
      </ul>
      <p>
        Discussions about why method overloading is useful, what alternative approaches could be taken, or what trade-offs using each specific implementation entails would be far more productive with an example like this.
      </p>
      <p>
        The <em>Big Idea</em> should be the final stop in the learning process, not the first stop.
        Once the student can anchor their understanding to something <em>real</em>, they can more quickly grasp other <em>real</em> examples. After that, the final step to fully understanding something is a much smaller one. 
      </p>
      <p>
        Even after coding for more than two decades, I still get lost when looking at examples that use metasyntactic or abstract variables. Never have I learned a concept and thought to myself, in hindsight, &ldquo;Boy, I really wish they used <code>foo</code> and <code>bar</code> more so I would understand the concept better!&rdquo;
      </p>
      <hr />
      <p>
        The <em>Big Idea</em> behind this entire book is just this. Your code&mdash;no matter how elegantly you believe you&rsquo;ve written it&mdash;will always feel foreign and mysterious to someone else at first.  That somebody else might even be <em>you</em> reacquainting yourself with your own code down the road. It&rsquo;s your job to invite the reader into your space with open arms. 
      </p>
      <p>
        It&rsquo;s like putting the welcome mat down before the front doorstep of your code. So long as human beings are still writing code, the practice of naming things well will never go out of fashion.
      </p>
      <p>
        Naming things well can be the difference between a home people want to keep alive and thriving versus one we&rsquo;d soon rather leave behind.
      </p>
    </div>
  </div>
</div>

<div class="chapter end" id="ch-authors-note">
<div class="grid-content">
  <div class="content">
    <h2>Author&rsquo;s Note</h2>
    <p>
      I&rsquo;ve had the unique opportunity of working on the same piece of software, <a href="https://www.donedone.com">DoneDone</a>, for more than a decade. And yet, even after all these years, every time I dig back in, I still spot some place where I think a name could be expressed better. 
      It&rsquo;s with this perspective that I hope this book can bring something unique to the topic of naming things. 
    </p>
    <p>
      I am sure there are many thoughts and strategies you may have that I did not cover, and I&rsquo;m equally sure my viewpoints are up for debate.
      If you&rsquo;d like to connect about this book in any way, message me on Twitter <a href="https://www.twitter.com/developerscode">@developerscode</a> or email me directly at <a href="mailto:kawai.cheung@donedone.com">kawai.cheung@donedone.com</a>.
    </p>
    <p>
      If you&rsquo;re interested in other things I&rsquo;ve written, read some of my past thoughts on <a href="http://www.lifeimitatescode.com">Life Imitates Code</a> or grab a copy of my book on software development life, <a href="http://thedeveloperscode.com">The Developer&rsquo;s Code</a>.
    </p>
    <p>
      Thanks for reading!<br />
      <span class="sig">Ka Wai Cheung<br />February 2020</span>
    </p>
    </p>
  </div>
</div>
</div>



<div id="grid-prev-next">
  <div class="next"></div>
  <div class="prev"></div>
</div>

<div class="footer">
  Copyright &copy; 2020, DoneDone LLC. All rights reserved.
</div>

</body>


<script>
  
  $(function() {

    var assetOriginal = "";
    var hasAssetRolloverPad = "0";
    var curChapterId = "";


    $("div.chapter:not(.end)").each(function(i) {
      $(this).children("div.grid-content").first().children("div.content").first().prepend("<h4>Chapter " + (i + 1) + "</h4>");
    });

    showCurrentChapter();

    if (getCurChapterId() == getIntroChapterId())
    {
      $("body").delay(1000).fadeIn(1000);
    }
    else
    {
      $("body").show();
      scrollToChapter(null);
    }


    $(window).scroll(function (event) {

        if ($(getCurChapterId()).offset().top - 1 <= $(window).scrollTop())
        {
          $("div.menu").fadeIn(200);
        }
        else
        {
          $("div.menu").hide();
        }

        // Do something
    });

    $("a.code-ref").hover(function(e) {
        var codeRef = $(this).data("code-ref");
        $("pre span." + codeRef).addClass("emphasis");
    });

    $("a.code-ref").click(function(e) {
        e.preventDefault();
        e.stopImmediatePropagation();
    });

    $("a.code-ref").mouseleave(function(e) {
        var codeRef = $(this).data("code-ref");
        $("pre span." + codeRef).removeClass("emphasis");
    });

    $("#btn-cover-click").click(function(e) {
        scrollToChapter(e);
    });

    $("body").on("click", "a:not('#btn-cover-click')", function(e) {
      if ($(this).attr("href").startsWith("#"))
      {
        showChapter($(this).attr("href"));
      }
    });

    $("div.menu > a").click(function(e) {
      e.preventDefault();
      openMenu();
    });

    $("div.toc > a.close-btn").click(function(e) {
      e.preventDefault();
      closeMenu();
    });

    $("div.toc-content > a").click(function(e) {
      closeMenu();
    });




    /* 
     * Functions
     */
    function openMenu() {
      $("#toc").attr("style", "width:100%");
    }

    function closeMenu() {
      $("#toc").attr("style", "width:0%");
    }

    function showChapter(chapterId)
    {
      if (chapterId == getIntroChapterId())
      {
        $("#btn-cover-click").html("Start reading...");
      }
      else
      {
        $("#btn-cover-click").html("Keep reading...");
      }

      $("div.chapter").hide();

      $("div.toc-content > a").removeClass("selected");
      $("div.toc-content > a[href='" + chapterId + "']").addClass("selected");

      $(chapterId).fadeIn(200);

      var prevChapter = $(chapterId).prev(".chapter");
      var nextChapter = $(chapterId).next(".chapter");
      var prevLinkHolder = $("#grid-prev-next").find("div").last();
      var nextLinkHolder = $("#grid-prev-next").find("div").first();

      if (prevChapter.length !== 0)
      {
        prevLinkHolder.html("<a href=\"#" + prevChapter.attr("id") + "\">&larr; " + prevChapter.find("h2").first().html() + "</a></div>");
      }
      else
      {
        prevLinkHolder.html("");
      }

      if (nextChapter.length !== 0)
      {
        nextLinkHolder.html("<a href=\"#" + nextChapter.attr("id") + "\">" + nextChapter.find("h2").first().html() + " &rarr;</a></div>");
      }
      else
      {
        nextLinkHolder.html("");
      }
    }

    function showCurrentChapter()
    {
      showChapter(getCurChapterId());
    }

    function scrollToChapter(e)
    {
      if (e != null) {
        e.preventDefault();
      }

      $("body,html").animate(
        {
          scrollTop: $(getCurChapterId()).offset().top
        },
        500 //speed
      );
    }

    function isRootUrl()
    {
      var url = window.location.href;
      return url.indexOf("#") <= 0 || url.indexOf("#") == url.length - 1;
    }

    function getCurChapterId()
    {    
      if (isRootUrl())
      {
        return getIntroChapterId();
      }

      var url = window.location.href;
      return url.substring(url.indexOf("#"));
    }

    function getIntroChapterId()
    {
      return $("div.toc-content > a").first().attr("href");
    }
  });

</script>

</html>
